"use strict";(self.webpackChunkahnlich_web=self.webpackChunkahnlich_web||[]).push([[4643],{28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var s=i(96540);const l={},c=s.createContext(l);function r(e){const n=s.useContext(c);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:r(e.components),s.createElement(c.Provider,{value:n},e.children)}},74970:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>o,default:()=>a,frontMatter:()=>r,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"ahnlich-in-production/deployment","title":"Deployment","description":"Ahnlich consists of two services that work together:","source":"@site/docs/ahnlich-in-production/deployment.md","sourceDirName":"ahnlich-in-production","slug":"/ahnlich-in-production/deployment","permalink":"/docs/ahnlich-in-production/deployment","draft":false,"unlisted":false,"editUrl":"https://github.com/deven96/ahnlich/tree/main/web/ahnlich-web/docs/ahnlich-in-production/deployment.md","tags":[],"version":"current","sidebarPosition":10,"frontMatter":{"title":"Deployment","sidebar_position":10},"sidebar":"docsSidebar","previous":{"title":"Distributed Tracing","permalink":"/docs/client-libraries/rust/distributed-tracing"},"next":{"title":"Tracing","permalink":"/docs/ahnlich-in-production/tracing"}}');var l=i(74848),c=i(28453);const r={title:"Deployment",sidebar_position:10},o="Deployment",t={},d=[{value:"Official Docker Images",id:"official-docker-images",level:2},{value:"Docker Compose Setup",id:"docker-compose-setup",level:2},{value:"Persistence",id:"persistence",level:2},{value:"Cloud Deployments",id:"cloud-deployments",level:2},{value:"AWS EC2",id:"aws-ec2",level:3},{value:"GCP Compute Engine",id:"gcp-compute-engine",level:3},{value:"Coolify",id:"coolify",level:3},{value:"Google Cloud Run",id:"google-cloud-run",level:3},{value:"Production Checklist",id:"production-checklist",level:2},{value:"References",id:"references",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,c.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"deployment",children:"Deployment"})}),"\n",(0,l.jsx)(n.p,{children:"Ahnlich consists of two services that work together:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"ahnlich-db"}),": In-memory vector store with exact similarity search"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"ahnlich-ai"}),": AI proxy that transforms raw inputs (text/image) into embeddings"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"The recommended production setup runs both services using Docker."}),"\n",(0,l.jsx)(n.h2,{id:"official-docker-images",children:"Official Docker Images"}),"\n",(0,l.jsxs)(n.p,{children:["Ahnlich provides prebuilt images on ",(0,l.jsx)(n.a,{href:"https://github.com/deven96/ahnlich/pkgs/container/ahnlich-db",children:"GitHub Container Registry"}),":"]}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"DB"}),": ",(0,l.jsx)(n.code,{children:"ghcr.io/deven96/ahnlich-db:latest"})]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.strong,{children:"AI"}),": ",(0,l.jsx)(n.code,{children:"ghcr.io/deven96/ahnlich-ai:latest"})]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"docker-compose-setup",children:"Docker Compose Setup"}),"\n",(0,l.jsx)(n.p,{children:"The easiest deployment for local or cloud use:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:'version: "3.8"\n\nservices:\n  ahnlich_db:\n    image: ghcr.io/deven96/ahnlich-db:latest\n    command: >\n      ahnlich-db run --host 0.0.0.0\n      --enable-persistence\n      --persist-location /root/.ahnlich/data/db.dat\n      --persistence-interval 300\n    ports:\n      - "1369:1369"\n    volumes:\n      - ./data:/root/.ahnlich/data\n\n  ahnlich_ai:\n    image: ghcr.io/deven96/ahnlich-ai:latest\n    command: >\n      ahnlich-ai run --host 0.0.0.0\n      --db-host ahnlich_db\n      --enable-persistence\n      --persist-location /root/.ahnlich/data/ai.dat\n      --persistence-interval 300\n    ports:\n      - "1370:1370"\n    volumes:\n      - ./data:/root/.ahnlich/data\n      - ./ahnlich_ai_model_cache:/root/.ahnlich/models\n'})}),"\n",(0,l.jsx)(n.p,{children:"This configuration:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Enables disk persistence (data survives restarts)"}),"\n",(0,l.jsx)(n.li,{children:"Maps ports 1369 (DB) and 1370 (AI)"}),"\n",(0,l.jsx)(n.li,{children:"Caches AI models across restarts"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"persistence",children:"Persistence"}),"\n",(0,l.jsx)(n.p,{children:"Without persistence, all data is in-memory and lost on restart. To enable:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"--enable-persistence\n--persist-location /root/.ahnlich/data/db.dat\n--persistence-interval 300  # seconds\n"})}),"\n",(0,l.jsx)(n.p,{children:"Mount the persist location to a host volume:"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  - ./data:/root/.ahnlich/data\n"})}),"\n",(0,l.jsx)(n.h2,{id:"cloud-deployments",children:"Cloud Deployments"}),"\n",(0,l.jsx)(n.h3,{id:"aws-ec2",children:"AWS EC2"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Launch EC2 instance"}),"\n",(0,l.jsx)(n.li,{children:"Install Docker"}),"\n",(0,l.jsxs)(n.li,{children:["Run DB:","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name ahnlich_db \\\n  -p 1369:1369 \\\n  -v /data/ahnlich:/root/.ahnlich/data \\\n  ghcr.io/deven96/ahnlich-db:latest \\\n  ahnlich-db run --host 0.0.0.0 \\\n    --enable-persistence \\\n    --persist-location /root/.ahnlich/data/db.dat\n"})}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Run AI:","\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"docker run -d \\\n  --name ahnlich_ai \\\n  -p 1370:1370 \\\n  --link ahnlich_db \\\n  -v /data/ahnlich:/root/.ahnlich/data \\\n  -v /data/models:/root/.ahnlich/models \\\n  ghcr.io/deven96/ahnlich-ai:latest \\\n  ahnlich-ai run --host 0.0.0.0 \\\n    --db-host ahnlich_db \\\n    --enable-persistence \\\n    --persist-location /root/.ahnlich/data/ai.dat\n"})}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:"Open ports 1369 and 1370 in your security group."}),"\n",(0,l.jsx)(n.h3,{id:"gcp-compute-engine",children:"GCP Compute Engine"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Create VM instance"}),"\n",(0,l.jsx)(n.li,{children:"Install Docker"}),"\n",(0,l.jsx)(n.li,{children:"Follow same Docker commands as AWS EC2"}),"\n",(0,l.jsx)(n.li,{children:"Create firewall rules for TCP ports 1369 and 1370"}),"\n",(0,l.jsxs)(n.li,{children:["Mount a persistent disk to ",(0,l.jsx)(n.code,{children:"/data"})," for persistence"]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"coolify",children:"Coolify"}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://coolify.io/",children:"Coolify"})," is a self-hosted PaaS supporting Docker images."]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.strong,{children:"Steps:"})}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsx)(n.li,{children:"Create new app \u2192 Docker Image"}),"\n",(0,l.jsxs)(n.li,{children:["Set images:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["DB: ",(0,l.jsx)(n.code,{children:"ghcr.io/deven96/ahnlich-db:latest"})]}),"\n",(0,l.jsxs)(n.li,{children:["AI: ",(0,l.jsx)(n.code,{children:"ghcr.io/deven96/ahnlich-ai:latest"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Configure run commands:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["DB: ",(0,l.jsx)(n.code,{children:"ahnlich-db run --host 0.0.0.0 --enable-persistence --persist-location /root/.ahnlich/data/db.dat"})]}),"\n",(0,l.jsxs)(n.li,{children:["AI: ",(0,l.jsx)(n.code,{children:"ahnlich-ai run --host 0.0.0.0 --db-host ahnlich_db --enable-persistence --persist-location /root/.ahnlich/data/ai.dat"})]}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Mount volumes:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/root/.ahnlich/data"})," (persistence)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"/root/.ahnlich/models"})," (AI model cache)"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.li,{children:"Expose ports 1369 and 1370"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"google-cloud-run",children:"Google Cloud Run"}),"\n",(0,l.jsx)(n.p,{children:"Cloud Run supports gRPC containers with these requirements:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Containers listen on ",(0,l.jsx)(n.code,{children:"$PORT"})," (use ",(0,l.jsx)(n.code,{children:"--port $PORT"}),")"]}),"\n",(0,l.jsx)(n.li,{children:"Expose endpoints over HTTPS (port 443)"}),"\n",(0,l.jsxs)(n.li,{children:["Configure ",(0,l.jsx)(n.code,{children:"ahnlich-ai"})," with ",(0,l.jsx)(n.code,{children:"--db-host <Cloud Run URL>"})]}),"\n"]}),"\n",(0,l.jsxs)(n.p,{children:["See ",(0,l.jsx)(n.a,{href:"https://cloud.google.com/run/docs/triggering/grpc",children:"Cloud Run gRPC Guide"})]}),"\n",(0,l.jsx)(n.h2,{id:"production-checklist",children:"Production Checklist"}),"\n",(0,l.jsxs)(n.table,{children:[(0,l.jsx)(n.thead,{children:(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.th,{children:"Item"}),(0,l.jsx)(n.th,{children:"Recommendation"})]})}),(0,l.jsxs)(n.tbody,{children:[(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Ports"}),(0,l.jsx)(n.td,{children:"Expose 1369 (DB) and 1370 (AI)"})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"DB Connection"}),(0,l.jsxs)(n.td,{children:[(0,l.jsx)(n.code,{children:"ahnlich-ai"})," must use ",(0,l.jsx)(n.code,{children:"--db-host"})," with reachable address"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Persistence"}),(0,l.jsxs)(n.td,{children:["Enable with ",(0,l.jsx)(n.code,{children:"--enable-persistence"})," and bind volumes"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Model Caching"}),(0,l.jsxs)(n.td,{children:["Mount ",(0,l.jsx)(n.code,{children:"/root/.ahnlich/models"})," for AI"]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Tracing"}),(0,l.jsxs)(n.td,{children:["Optional: ",(0,l.jsx)(n.code,{children:"--enable-tracing --otel-endpoint <collector>"})]})]}),(0,l.jsxs)(n.tr,{children:[(0,l.jsx)(n.td,{children:"Security"}),(0,l.jsx)(n.td,{children:"Use TLS via proxy/load balancer for external exposure"})]})]})]}),"\n",(0,l.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/deven96/ahnlich",children:"Ahnlich GitHub"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/deven96/ahnlich/pkgs/container/ahnlich-db",children:"Docker Images"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://github.com/deven96/ahnlich/blob/main/docker-compose.yml",children:"Docker Compose Example"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.coolify.io/",children:"Coolify Docs"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://docs.aws.amazon.com/AmazonECS/latest/developerguide/docker-basics.html",children:"AWS EC2 Docker"})}),"\n",(0,l.jsx)(n.li,{children:(0,l.jsx)(n.a,{href:"https://cloud.google.com/run/docs/triggering/grpc",children:"Cloud Run gRPC"})}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,c.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}}}]);