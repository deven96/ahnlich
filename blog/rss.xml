<?xml version="1.0" encoding="utf-8"?><?xml-stylesheet type="text/xsl" href="rss.xsl"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>Ahnlich Blog</title>
        <link>https://ahnlich.dev/blog</link>
        <description>Ahnlich Blog</description>
        <lastBuildDate>Sat, 14 Feb 2026 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Making Ahnlich Faster with SIMD: A 4.7x Speedup Story]]></title>
            <link>https://ahnlich.dev/blog/simd-optimization-vector-database</link>
            <guid>https://ahnlich.dev/blog/simd-optimization-vector-database</guid>
            <pubDate>Sat, 14 Feb 2026 00:00:00 GMT</pubDate>
            <description><![CDATA[Vector databases power modern search, from finding similar images to semantic document retrieval. But there's a hidden performance bottleneck: calculating distances between millions of high-dimensional vectors requires billions of operations per query. In this post, I'll show you how we used SIMD (Single Instruction, Multiple Data) to make Ahnlich 4.7x faster at these calculations.]]></description>
            <content:encoded><![CDATA[<p>Vector databases power modern search, from finding similar images to semantic document retrieval. But there's a hidden performance bottleneck: calculating distances between millions of high-dimensional vectors requires billions of operations per query. In this post, I'll show you how we used SIMD (Single Instruction, Multiple Data) to make <a href="https://github.com/deven96/ahnlich" target="_blank" rel="noopener noreferrer" class="">Ahnlich</a> <strong>4.7x faster</strong> at these calculations.</p>
<p><img decoding="async" loading="lazy" alt="SIMD Optimization Hero" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI2MzAiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CiAgPCEtLSBCYWNrZ3JvdW5kIGdyYWRpZW50IC0tPgogIDxkZWZzPgogICAgPGxpbmVhckdyYWRpZW50IGlkPSJiZyIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMTAwJSI+CiAgICAgIDxzdG9wIG9mZnNldD0iMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiMxZTNhOGE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3R5bGU9InN0b3AtY29sb3I6IzMxMmU4MTtzdG9wLW9wYWNpdHk6MSIgLz4KICAgIDwvbGluZWFyR3JhZGllbnQ+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImhpZ2hsaWdodCIgeDE9IjAlIiB5MT0iMCUiIHgyPSIxMDAlIiB5Mj0iMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdHlsZT0ic3RvcC1jb2xvcjojNjBhNWZhO3N0b3Atb3BhY2l0eToxIiAvPgogICAgICA8c3RvcCBvZmZzZXQ9IjEwMCUiIHN0eWxlPSJzdG9wLWNvbG9yOiNhNzhiZmE7c3RvcC1vcGFjaXR5OjEiIC8+CiAgICA8L2xpbmVhckdyYWRpZW50PgogIDwvZGVmcz4KICAKICA8IS0tIEJhY2tncm91bmQgLS0+CiAgPHJlY3Qgd2lkdGg9IjEyMDAiIGhlaWdodD0iNjMwIiBmaWxsPSJ1cmwoI2JnKSIvPgogIAogIDwhLS0gVGl0bGUgLS0+CiAgPHRleHQgeD0iNjAwIiB5PSIxMDAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI1NiIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4KICAgIFNJTUQgT3B0aW1pemF0aW9uIGluIEFobmxpY2gKICA8L3RleHQ+CiAgCiAgPHRleHQgeD0iNjAwIiB5PSIxNTAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzMiIgZmlsbD0iIzkzYzVmZCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+CiAgICA0Ljd4IEZhc3RlciBWZWN0b3IgU2VhcmNoCiAgPC90ZXh0PgogIAogIDwhLS0gU2NhbGFyIFByb2Nlc3NpbmcgLS0+CiAgPHRleHQgeD0iMjAwIiB5PSIyNDAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjQiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjZmJiZjI0Ij4KICAgIFNjYWxhcgogIDwvdGV4dD4KICAKICA8IS0tIFNjYWxhciBib3hlcyAtIHZlcnRpY2FsIC0tPgogIDxyZWN0IHg9IjE1MCIgeT0iMjYwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiM2MGE1ZmEiIHN0cm9rZS13aWR0aD0iMiIgcng9IjQiLz4KICA8dGV4dCB4PSIyMDAiIHk9IjI5MiIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPjEuMCDDlyAyLjA8L3RleHQ+CiAgCiAgPHJlY3QgeD0iMTUwIiB5PSIzMjAiIHdpZHRoPSIxMDAiIGhlaWdodD0iNTAiIGZpbGw9IiMzNzQxNTEiIHN0cm9rZT0iIzYwYTVmYSIgc3Ryb2tlLXdpZHRoPSIyIiByeD0iNCIvPgogIDx0ZXh0IHg9IjIwMCIgeT0iMzUyIiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjE4IiBmaWxsPSJ3aGl0ZSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+MS41IMOXIDIuNTwvdGV4dD4KICAKICA8cmVjdCB4PSIxNTAiIHk9IjM4MCIgd2lkdGg9IjEwMCIgaGVpZ2h0PSI1MCIgZmlsbD0iIzM3NDE1MSIgc3Ryb2tlPSIjNjBhNWZhIiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI0Ii8+CiAgPHRleHQgeD0iMjAwIiB5PSI0MTIiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTgiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj4yLjAgw5cgMy4wPC90ZXh0PgogIAogIDxyZWN0IHg9IjE1MCIgeT0iNDQwIiB3aWR0aD0iMTAwIiBoZWlnaHQ9IjUwIiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiM2MGE1ZmEiIHN0cm9rZS13aWR0aD0iMiIgcng9IjQiLz4KICA8dGV4dCB4PSIyMDAiIHk9IjQ3MiIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxOCIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPjIuNSDDlyAzLjU8L3RleHQ+CiAgCiAgPCEtLSBBcnJvdyAtLT4KICA8dGV4dCB4PSIzMjAiIHk9IjM4MCIgZm9udC1mYW1pbHk9IkFyaWFsIiBmb250LXNpemU9IjM2IiBmaWxsPSIjOWNhM2FmIj7ihpI8L3RleHQ+CiAgCiAgPHRleHQgeD0iMzgwIiB5PSIzODAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjAiIGZpbGw9IiNmYmJmMjQiPgogICAgNCBjeWNsZXMKICA8L3RleHQ+CiAgCiAgPCEtLSBTSU1EIFByb2Nlc3NpbmcgLS0+CiAgPHRleHQgeD0iODAwIiB5PSIyNDAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMjQiIGZvbnQtd2VpZ2h0PSJib2xkIiBmaWxsPSIjMTBiOTgxIj4KICAgIFNJTUQgKDQtd2lkZSkKICA8L3RleHQ+CiAgCiAgPCEtLSBTSU1EIHNpbmdsZSBib3ggLS0+CiAgPHJlY3QgeD0iNjUwIiB5PSIzMDAiIHdpZHRoPSIzMDAiIGhlaWdodD0iMTIwIiBmaWxsPSIjMzc0MTUxIiBzdHJva2U9IiMxMGI5ODEiIHN0cm9rZS13aWR0aD0iMyIgcng9IjQiLz4KICAKICA8dGV4dCB4PSI4MDAiIHk9IjM0MCIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlsxLjAsIDEuNSwgMi4wLCAyLjVdPC90ZXh0PgogIDx0ZXh0IHg9IjgwMCIgeT0iMzY1IiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjI0IiBmaWxsPSIjMTBiOTgxIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj7DlzwvdGV4dD4KICA8dGV4dCB4PSI4MDAiIHk9IjM5NSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNiIgZmlsbD0id2hpdGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlsyLjAsIDIuNSwgMy4wLCAzLjVdPC90ZXh0PgogIAogIDwhLS0gQXJyb3cgLS0+CiAgPHRleHQgeD0iOTkwIiB5PSIzNjUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIzNiIgZmlsbD0iIzljYTNhZiI+4oaSPC90ZXh0PgogIAogIDx0ZXh0IHg9IjEwNDAiIHk9IjM2NSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIyMCIgZmlsbD0iIzEwYjk4MSI+CiAgICAxIGN5Y2xlCiAgPC90ZXh0PgogIAogIDwhLS0gUGVyZm9ybWFuY2UgbGFiZWwgLS0+CiAgPHJlY3QgeD0iNDAwIiB5PSI1MzAiIHdpZHRoPSI0MDAiIGhlaWdodD0iNjAiIGZpbGw9IiMwNjVmNDYiIHJ4PSI4Ii8+CiAgPHRleHQgeD0iNjAwIiB5PSI1NzAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIyOCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IiMxMGI5ODEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPgogICAg4pqhIDQuN3ggU3BlZWR1cCBvbiBBUk0gTkVPTgogIDwvdGV4dD4KPC9zdmc+Cg==" width="1200" height="630" class="img_ev3q"></p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="whats-a-vector-database-anyway">What's a Vector Database Anyway?<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#whats-a-vector-database-anyway" class="hash-link" aria-label="Direct link to What's a Vector Database Anyway?" title="Direct link to What's a Vector Database Anyway?" translate="no">​</a></h2>
<p>Most developers are familiar with traditional databases where you filter by exact criteria. A friend recently showed me his financial market data queries that looked like this:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">results </span><span class="token operator">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">with_text_search</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"tech stocks"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">with_date_filter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">start</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"2024-01-01"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> end</span><span class="token operator">=</span><span class="token string" style="color:rgb(255, 121, 198)">"2024-12-31"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">with_creator</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Goldman Sachs"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">with_soft_deletion</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token boolean">False</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">limit</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">100</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><br></span></code></pre></div></div>
<p>He was chaining together filters trying to find relevant reports. The problem? He already knew what he wanted but still had to manually specify every constraint. What if he could just search "recent tech stock analysis from major banks" and get exactly what he needed?</p>
<p>That's where vector databases shine.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="traditional-search-vs-semantic-search">Traditional Search vs Semantic Search<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#traditional-search-vs-semantic-search" class="hash-link" aria-label="Direct link to Traditional Search vs Semantic Search" title="Direct link to Traditional Search vs Semantic Search" translate="no">​</a></h3>
<p><strong>Traditional databases</strong> match exact criteria. You tell them exactly what to look for: specific dates, specific creators, specific keywords. It's like searching for your friend at a concert by checking "wearing a red shirt AND standing near the stage AND arrived at 7pm."</p>
<p><strong>Vector databases</strong> work with embeddings. First, your data passes through a model (like BERT, OpenAI, or others) that converts text/images into vectors (lists of numbers representing semantic meaning). The vector database then stores these embeddings and finds items that are <em>similar</em> to your query based on mathematical distance, even if the words are completely different. Some databases like Ahnlich even let you specify the embedding model as an argument, handling the conversion automatically.</p>
<p>Let's visualize this with a simple example. Say we have three sentences converted to 2D vectors (real embeddings are 100s or 1000s of dimensions, but 2D is easier to see):</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">"cat sleeps"   → [0.77, 0.23]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">"dog sleeping" → [0.7, 0.3]  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">"I ate pizza"  → [0.1, 0.9]</span><br></span></code></pre></div></div>
<p>Plotting these in 2D space:</p>
<p><img decoding="async" loading="lazy" alt="Vector 2D Plot" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxtYXJrZXIgaWQ9ImFycm93aGVhZCIgbWFya2VyV2lkdGg9IjEwIiBtYXJrZXJIZWlnaHQ9IjEwIiByZWZYPSI5IiByZWZZPSIzIiBvcmllbnQ9ImF1dG8iPgogICAgICA8cG9seWdvbiBwb2ludHM9IjAgMCwgMTAgMywgMCA2IiBmaWxsPSIjOTRhM2I4IiAvPgogICAgPC9tYXJrZXI+CiAgPC9kZWZzPgogIAogIDwhLS0gQmFja2dyb3VuZCAtLT4KICA8cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgZmlsbD0iIzBmMTcyYSIvPgogIAogIDwhLS0gVGl0bGUgLS0+CiAgPHRleHQgeD0iNDAwIiB5PSIzNSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjIwIiBmaWxsPSIjZjFmNWY5IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+VmVjdG9yIFNpbWlsYXJpdHkgaW4gMkQgU3BhY2U8L3RleHQ+CiAgCiAgPCEtLSBQbG90IGFyZWEgYmFja2dyb3VuZCAtLT4KICA8cmVjdCB4PSI4MCIgeT0iNzAiIHdpZHRoPSI0NTAiIGhlaWdodD0iNDUwIiBmaWxsPSIjMWUyOTNiIiBvcGFjaXR5PSIwLjMiIHJ4PSI0Ii8+CiAgCiAgPCEtLSBHcmlkIGxpbmVzIC0tPgogIDxsaW5lIHgxPSI4MCIgeTE9IjUyMCIgeDI9IjUzMCIgeTI9IjUyMCIgc3Ryb2tlPSIjMzM0MTU1IiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1kYXNoYXJyYXk9IjIsMiIvPgogIDxsaW5lIHgxPSI4MCIgeTE9IjI5NSIgeDI9IjUzMCIgeTI9IjI5NSIgc3Ryb2tlPSIjMzM0MTU1IiBzdHJva2Utd2lkdGg9IjEiIHN0cm9rZS1kYXNoYXJyYXk9IjIsMiIvPgogIDxsaW5lIHgxPSI4MCIgeTE9IjcwIiB4Mj0iODAiIHkyPSI1MjAiIHN0cm9rZT0iIzMzNDE1NSIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtZGFzaGFycmF5PSIyLDIiLz4KICA8bGluZSB4MT0iMzA1IiB5MT0iNzAiIHgyPSIzMDUiIHkyPSI1MjAiIHN0cm9rZT0iIzMzNDE1NSIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtZGFzaGFycmF5PSIyLDIiLz4KICA8bGluZSB4MT0iNTMwIiB5MT0iNzAiIHgyPSI1MzAiIHkyPSI1MjAiIHN0cm9rZT0iIzMzNDE1NSIgc3Ryb2tlLXdpZHRoPSIxIiBzdHJva2UtZGFzaGFycmF5PSIyLDIiLz4KICAKICA8IS0tIEF4ZXMgLS0+CiAgPGxpbmUgeDE9IjgwIiB5MT0iNzAiIHgyPSI4MCIgeTI9IjUyMCIgc3Ryb2tlPSIjOTRhM2I4IiBzdHJva2Utd2lkdGg9IjIuNSIgbWFya2VyLWVuZD0idXJsKCNhcnJvd2hlYWQpIi8+CiAgPGxpbmUgeDE9IjgwIiB5MT0iNTIwIiB4Mj0iNTMwIiB5Mj0iNTIwIiBzdHJva2U9IiM5NGEzYjgiIHN0cm9rZS13aWR0aD0iMi41IiBtYXJrZXItZW5kPSJ1cmwoI2Fycm93aGVhZCkiLz4KICAKICA8IS0tIFkgYXhpcyBsYWJlbHMgLS0+CiAgPHRleHQgeD0iNTAiIHk9Ijc1IiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjE1IiBmaWxsPSIjY2JkNWUxIiBmb250LXdlaWdodD0iYm9sZCI+MS4wPC90ZXh0PgogIDx0ZXh0IHg9IjUwIiB5PSIzMDAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTUiIGZpbGw9IiNjYmQ1ZTEiIGZvbnQtd2VpZ2h0PSJib2xkIj4wLjU8L3RleHQ+CiAgPHRleHQgeD0iNTAiIHk9IjUyNSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNSIgZmlsbD0iI2NiZDVlMSIgZm9udC13ZWlnaHQ9ImJvbGQiPjAuMDwvdGV4dD4KICAKICA8IS0tIFggYXhpcyBsYWJlbHMgLS0+CiAgPHRleHQgeD0iNzUiIHk9IjU0NSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNSIgZmlsbD0iI2NiZDVlMSIgZm9udC13ZWlnaHQ9ImJvbGQiPjAuMDwvdGV4dD4KICA8dGV4dCB4PSIyOTUiIHk9IjU0NSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNSIgZmlsbD0iI2NiZDVlMSIgZm9udC13ZWlnaHQ9ImJvbGQiPjAuNTwvdGV4dD4KICA8dGV4dCB4PSI1MjAiIHk9IjU0NSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNSIgZmlsbD0iI2NiZDVlMSIgZm9udC13ZWlnaHQ9ImJvbGQiPjEuMDwvdGV4dD4KICAKICA8IS0tIEF4aXMgdGl0bGVzIC0tPgogIDx0ZXh0IHg9IjMwNSIgeT0iNTc1IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTciIGZpbGw9IiNlMmU4ZjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtd2VpZ2h0PSJib2xkIj5EaW1lbnNpb24gMTwvdGV4dD4KICA8dGV4dCB4PSIyNSIgeT0iMjk1IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTciIGZpbGw9IiNlMmU4ZjAiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtd2VpZ2h0PSJib2xkIiB0cmFuc2Zvcm09InJvdGF0ZSgtOTAgMjUgMjk1KSI+RGltZW5zaW9uIDI8L3RleHQ+CiAgCiAgPCEtLSBQbG90IGFyZWE6IHggcmFuZ2UgWzgwLCA1MzBdID0gNDUwcHggZm9yIFswLjAsIDEuMF0KICAgICAgICAgICAgICAgICAgeSByYW5nZSBbNTIwLCA3MF0gPSA0NTBweCBmb3IgWzAuMCwgMS4wXSAoaW52ZXJ0ZWQpIC0tPgogIAogIDwhLS0gUG9pbnQ6ICJJIGF0ZSBwaXp6YSIgWzAuMSwgMC45XSAtPiB4PTgwKzAuMSo0NTA9MTI1LCB5PTUyMC0wLjkqNDUwPTExNSAtLT4KICA8IS0tIExlYWRlciBsaW5lIHRvIGxhYmVsIGJveCAtIG5vdyBkb3R0ZWQgLS0+CiAgPGxpbmUgeDE9IjEyNSIgeTE9IjExNSIgeDI9IjIwMCIgeTI9IjExNSIgc3Ryb2tlPSIjNjBhNWZhIiBzdHJva2Utd2lkdGg9IjEuNSIgc3Ryb2tlLWRhc2hhcnJheT0iMywzIiBvcGFjaXR5PSIwLjUiLz4KICA8Y2lyY2xlIGN4PSIxMjUiIGN5PSIxMTUiIHI9IjQiIGZpbGw9IiMzYjgyZjYiIHN0cm9rZT0iIzYwYTVmYSIgc3Ryb2tlLXdpZHRoPSIxLjUiLz4KICA8cmVjdCB4PSIyMDAiIHk9Ijk1IiB3aWR0aD0iMTUwIiBoZWlnaHQ9IjQ1IiBmaWxsPSIjMWUyOTNiIiBzdHJva2U9IiM2MGE1ZmEiIHN0cm9rZS13aWR0aD0iMiIgcng9IjQiLz4KICA8dGV4dCB4PSIyNzUiIHk9IjExMyIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjBhNWZhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+IkkgYXRlIHBpenphIjwvdGV4dD4KICA8dGV4dCB4PSIyNzUiIHk9IjEzMCIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxMyIgZmlsbD0iIzk0YTNiOCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+WzAuMSwgMC45XTwvdGV4dD4KICAKICA8IS0tIFBvaW50OiAiZG9nIHNsZWVwaW5nIiBbMC43LCAwLjNdIC0+IHg9ODArMC43KjQ1MD0zOTUsIHk9NTIwLTAuMyo0NTA9Mzg1IC0tPgogIDwhLS0gTGVhZGVyIGxpbmUgdG8gbGFiZWwgYm94IC0gbm93IGRvdHRlZCAtLT4KICA8bGluZSB4MT0iMzk1IiB5MT0iMzg1IiB4Mj0iNTYwIiB5Mj0iMzAwIiBzdHJva2U9IiM2MGE1ZmEiIHN0cm9rZS13aWR0aD0iMS41IiBzdHJva2UtZGFzaGFycmF5PSIzLDMiIG9wYWNpdHk9IjAuNSIvPgogIDxjaXJjbGUgY3g9IjM5NSIgY3k9IjM4NSIgcj0iNCIgZmlsbD0iIzNiODJmNiIgc3Ryb2tlPSIjNjBhNWZhIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxyZWN0IHg9IjU2MCIgeT0iMjgwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjQ1IiBmaWxsPSIjMWUyOTNiIiBzdHJva2U9IiM2MGE1ZmEiIHN0cm9rZS13aWR0aD0iMiIgcng9IjQiLz4KICA8dGV4dCB4PSI2NDAiIHk9IjI5OCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjBhNWZhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+ImRvZyBzbGVlcGluZyI8L3RleHQ+CiAgPHRleHQgeD0iNjQwIiB5PSIzMTUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiM5NGEzYjgiIHRleHQtYW5jaG9yPSJtaWRkbGUiPlswLjcsIDAuM108L3RleHQ+CiAgCiAgPCEtLSBQb2ludDogImNhdCBzbGVlcHMiIFswLjc3LCAwLjIzXSAtPiB4PTgwKzAuNzcqNDUwPTQyNi41LCB5PTUyMC0wLjIzKjQ1MD00MTYuNSAtLT4KICA8IS0tIExlYWRlciBsaW5lIHRvIGxhYmVsIGJveCAtIG5vdyBkb3R0ZWQgLS0+CiAgPGxpbmUgeDE9IjQyNi41IiB5MT0iNDE2LjUiIHgyPSI1NjAiIHkyPSI0MzAiIHN0cm9rZT0iIzYwYTVmYSIgc3Ryb2tlLXdpZHRoPSIxLjUiIHN0cm9rZS1kYXNoYXJyYXk9IjMsMyIgb3BhY2l0eT0iMC41Ii8+CiAgPGNpcmNsZSBjeD0iNDI2LjUiIGN5PSI0MTYuNSIgcj0iNCIgZmlsbD0iIzNiODJmNiIgc3Ryb2tlPSIjNjBhNWZhIiBzdHJva2Utd2lkdGg9IjEuNSIvPgogIDxyZWN0IHg9IjU2MCIgeT0iNDEwIiB3aWR0aD0iMTYwIiBoZWlnaHQ9IjQ1IiBmaWxsPSIjMWUyOTNiIiBzdHJva2U9IiM2MGE1ZmEiIHN0cm9rZS13aWR0aD0iMiIgcng9IjQiLz4KICA8dGV4dCB4PSI2NDAiIHk9IjQyOCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE0IiBmaWxsPSIjNjBhNWZhIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+ImNhdCBzbGVlcHMiPC90ZXh0PgogIDx0ZXh0IHg9IjY0MCIgeT0iNDQ1IiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjEzIiBmaWxsPSIjOTRhM2I4IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5bMC43NywgMC4yM108L3RleHQ+CiAgCiAgPCEtLSBRdWVyeSBQb2ludDogImtpdHRlbiBuYXBwaW5nIiBbMC43NSwgMC4yNV0gLT4geD04MCswLjc1KjQ1MD00MTcuNSwgeT01MjAtMC4yNSo0NTA9NDA3LjUgLS0+CiAgPCEtLSBMZWFkZXIgbGluZSB0byBsYWJlbCBib3ggLSBub3cgZG90dGVkIC0tPgogIDxsaW5lIHgxPSI0MTcuNSIgeTE9IjQwNy41IiB4Mj0iNTYwIiB5Mj0iNTIwIiBzdHJva2U9IiMxMGI5ODEiIHN0cm9rZS13aWR0aD0iMiIgc3Ryb2tlLWRhc2hhcnJheT0iMywzIiBvcGFjaXR5PSIwLjYiLz4KICA8Y2lyY2xlIGN4PSI0MTcuNSIgY3k9IjQwNy41IiByPSI1IiBmaWxsPSIjMTBiOTgxIiBzdHJva2U9IiMzNGQzOTkiIHN0cm9rZS13aWR0aD0iMiIvPgogIDxyZWN0IHg9IjU2MCIgeT0iNTAwIiB3aWR0aD0iMjIwIiBoZWlnaHQ9IjY1IiBmaWxsPSIjMDY1ZjQ2IiBzdHJva2U9IiMxMGI5ODEiIHN0cm9rZS13aWR0aD0iMi41IiByeD0iNCIvPgogIDx0ZXh0IHg9IjY3MCIgeT0iNTIwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTUiIGZpbGw9IiMxMGI5ODEiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtd2VpZ2h0PSJib2xkIj5RVUVSWTogImtpdHRlbiBuYXBwaW5nIjwvdGV4dD4KICA8dGV4dCB4PSI2NzAiIHk9IjU0MCIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxMyIgZmlsbD0iIzZlZTdiNyIgdGV4dC1hbmNob3I9Im1pZGRsZSI+WzAuNzUsIDAuMjVdPC90ZXh0PgogIDx0ZXh0IHg9IjY3MCIgeT0iNTU2IiBmb250LWZhbWlseT0ibW9ub3NwYWNlIiBmb250LXNpemU9IjExIiBmaWxsPSIjNmVlN2I3IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5GaW5kaW5nIG5lYXJlc3QgbmVpZ2hib3JzLi4uPC90ZXh0Pgo8L3N2Zz4K" width="800" height="600" class="img_ev3q"></p>
<p>When you query <strong>"kitten napping" → [0.75, 0.25]</strong>, the vector database calculates the distance to each stored vector and finds the closest matches. Even though "kitten napping" doesn't use the exact words "cat" or "dog," the semantic meaning places it close to those vectors.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="how-distance-calculations-work">How Distance Calculations Work<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#how-distance-calculations-work" class="hash-link" aria-label="Direct link to How Distance Calculations Work" title="Direct link to How Distance Calculations Work" translate="no">​</a></h3>
<p>Vector databases use mathematical distance metrics to measure similarity:</p>
<ol>
<li class=""><strong>Euclidean Distance</strong> - Straight-line distance in n-dimensional space (lower = more similar)</li>
<li class=""><strong>Cosine Similarity</strong> - Angle between vectors, ignoring magnitude (1 = identical direction)</li>
<li class=""><strong>Dot Product</strong> - Measures alignment between vectors (higher = more similar)</li>
</ol>
<p>Let's calculate Euclidean distance for our query:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Query: "kitten napping" [0.75, 0.25]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Distance to "cat sleeps" [0.77, 0.23]:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = sqrt((0.75-0.77)² + (0.25-0.23)²) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = sqrt(0.0004 + 0.0004) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = 0.028 ✓ Closest match!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Distance to "dog sleeping" [0.7, 0.3]:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = sqrt((0.75-0.7)² + (0.25-0.3)²) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = sqrt(0.0025 + 0.0025)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = 0.071 ✓ Also close!</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Distance to "I ate pizza" [0.1, 0.9]:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = sqrt((0.75-0.1)² + (0.25-0.9)²) </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = sqrt(0.4225 + 0.4225)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">  = 0.92 ✗ Far away!</span><br></span></code></pre></div></div>
<p>The database returns the top results: "cat sleeps" (closest) and "dog sleeping" (second closest). Perfect semantic search!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-performance-challenge">The Performance Challenge<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#the-performance-challenge" class="hash-link" aria-label="Direct link to The Performance Challenge" title="Direct link to The Performance Challenge" translate="no">​</a></h3>
<p>Here's the catch: this toy example has 3 vectors in 2 dimensions. Real-world applications have:</p>
<ul>
<li class=""><strong>Millions of vectors</strong> (documents, images, products)</li>
<li class=""><strong>1024+ dimensions</strong> (typical embedding size)</li>
<li class=""><strong>Thousands of queries per second</strong></li>
</ul>
<p>For each query, you perform:</p>
<ul>
<li class=""><strong>100 million vectors × 1024 dimensions = 102 billion operations</strong></li>
</ul>
<p>A single search without optimization would take seconds or minutes. This is why vector databases obsess over performance, and why we need SIMD.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-similarity-search-problem-optimizing-distance-calculations">The Similarity Search Problem: Optimizing Distance Calculations<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#the-similarity-search-problem-optimizing-distance-calculations" class="hash-link" aria-label="Direct link to The Similarity Search Problem: Optimizing Distance Calculations" title="Direct link to The Similarity Search Problem: Optimizing Distance Calculations" translate="no">​</a></h2>
<p>At the heart of every vector database query are distance calculations. Let's look at dot product similarity as our example:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Scalar implementation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">dot_product_scalar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params operator">&amp;</span><span class="token closure-params">x</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token closure-params"> </span><span class="token closure-params operator">&amp;</span><span class="token closure-params">y</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> x </span><span class="token operator">*</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>For a 1024-dimensional vector, this performs 1024 multiplications and 1023 additions. When you're doing this for 100,000 vectors, that's over 100 million operations.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="enter-simd-parallel-processing-on-steroids">Enter SIMD: Parallel Processing on Steroids<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#enter-simd-parallel-processing-on-steroids" class="hash-link" aria-label="Direct link to Enter SIMD: Parallel Processing on Steroids" title="Direct link to Enter SIMD: Parallel Processing on Steroids" translate="no">​</a></h2>
<p>SIMD stands for Single Instruction, Multiple Data. Instead of processing one number at a time, SIMD lets your CPU process multiple numbers in a single instruction.</p>
<p>Think of it like this:</p>
<ul>
<li class=""><strong>Scalar</strong>: One cashier checking out one customer at a time</li>
<li class=""><strong>SIMD</strong>: Four cashiers working in perfect synchronization, all scanning items at the exact same moment</li>
</ul>
<p>Modern CPUs have SIMD instruction sets like SSE, AVX, and NEON (on ARM). On an M1 Mac, NEON can process 4 x f32 values simultaneously. On Intel/AMD with AVX-512, you can process 16 x f32 values at once!</p>
<p>Here's a visual representation:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Scalar Processing:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1.0] * [2.0] = [2.0]   ← One multiplication</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1.5] * [2.5] = [3.75]  ← Another multiplication  </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2.0] * [3.0] = [6.0]   ← Yet another...</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[2.5] * [3.5] = [8.75]  ← You get the idea</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SIMD Processing (4-wide):</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">[1.0, 1.5, 2.0, 2.5] * [2.0, 2.5, 3.0, 3.5] = [2.0, 3.75, 6.0, 8.75]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">         ↑ All done in ONE instruction! ↑</span><br></span></code></pre></div></div>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="implementing-simd-in-ahnlich">Implementing SIMD in Ahnlich<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#implementing-simd-in-ahnlich" class="hash-link" aria-label="Direct link to Implementing SIMD in Ahnlich" title="Direct link to Implementing SIMD in Ahnlich" translate="no">​</a></h2>
<p>For Ahnlich, we used the <a href="https://crates.io/crates/pulp" target="_blank" rel="noopener noreferrer" class=""><code>pulp</code></a> crate, which provides portable SIMD abstractions across different CPU architectures. Here's how we implemented SIMD dot product (<a href="https://github.com/deven96/ahnlich/blob/main/ahnlich/db/src/algorithm/similarity.rs#L134-L162" target="_blank" rel="noopener noreferrer" class="">see full implementation on GitHub</a>):</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">use</span><span class="token plain"> </span><span class="token namespace">pulp</span><span class="token namespace punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token class-name">Arch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">Simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token class-name">WithSimd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">struct</span><span class="token plain"> </span><span class="token type-definition class-name">DotProduct</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">'a</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">'a</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">'a</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">impl</span><span class="token plain"> </span><span class="token class-name">WithSimd</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token class-name">DotProduct</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">'_</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token type-definition class-name">Output</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token attribute attr-name" style="color:rgb(241, 250, 140)">#[inline(always)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">with_simd</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">Simd</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Output</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Split arrays into SIMD-aligned chunks and remainder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">first_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> first_tail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">as_simd_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">second_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> second_tail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">as_simd_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// SIMD accumulator starting at zero</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> sum_of_points </span><span class="token operator">=</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">splat_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Process SIMD chunks - 4 multiplies + 4 adds per iteration!</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">chunk_first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">chunk_second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> first_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">second_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sum_of_points </span><span class="token operator">=</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">mul_add_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">chunk_first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> chunk_second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> sum_of_points</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Reduce SIMD register to single value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> dot_product </span><span class="token operator">=</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">reduce_sum_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sum_of_points</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Handle remaining elements with scalar code</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        dot_product </span><span class="token operator">+=</span><span class="token plain"> first_tail</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">second_tail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params operator">&amp;</span><span class="token closure-params">x</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token closure-params"> </span><span class="token closure-params operator">&amp;</span><span class="token closure-params">y</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> x </span><span class="token operator">*</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        dot_product</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">pub</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">dot_product</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> arch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Arch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">dispatch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">DotProduct</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>Let's break down what's happening:</p>
<ol>
<li class=""><strong>Split into chunks</strong>: <code>as_simd_f32s</code> splits our arrays into SIMD-aligned chunks (groups of 4 for NEON) plus a remainder tail</li>
<li class=""><strong>SIMD accumulation</strong>: <code>mul_add_f32s</code> performs fused multiply-add on 4 values simultaneously</li>
<li class=""><strong>Reduction</strong>: <code>reduce_sum_f32s</code> adds all values in the SIMD register together</li>
<li class=""><strong>Handle remainder</strong>: Process any leftover elements with scalar code</li>
</ol>
<p>The same SIMD pattern extends to the other distance metrics Ahnlich supports. Each one benefits from parallel processing in different ways:</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cosine-similarity">Cosine Similarity<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#cosine-similarity" class="hash-link" aria-label="Direct link to Cosine Similarity" title="Direct link to Cosine Similarity" translate="no">​</a></h3>
<p>Cosine similarity measures the angle between two vectors, making it perfect for comparing semantic meaning in text embeddings. The formula is: <strong>dot(A, B) / (magnitude(A) × magnitude(B))</strong></p>
<p>The computation involves two SIMD operations: calculating the dot product (which we already saw) and computing the magnitudes. Here's how it looks (<a href="https://github.com/deven96/ahnlich/blob/main/ahnlich/db/src/algorithm/similarity.rs#L109-L125" target="_blank" rel="noopener noreferrer" class="">source</a>):</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">cosine_similarity</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> dot_product </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dot_product</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Calculate magnitudes using SIMD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> arch </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Arch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">new</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> magnitude </span><span class="token operator">=</span><span class="token plain"> arch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">dispatch</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token class-name">Magnitude</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    dot_product </span><span class="token operator">/</span><span class="token plain"> magnitude</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>The magnitude calculation also uses SIMD to compute <code>sqrt(Σ(x²))</code> for both vectors simultaneously, giving us another layer of parallelization.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="euclidean-distance">Euclidean Distance<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#euclidean-distance" class="hash-link" aria-label="Direct link to Euclidean Distance" title="Direct link to Euclidean Distance" translate="no">​</a></h3>
<p>Euclidean distance measures the straight-line distance between two points in high-dimensional space. It's commonly used for image embeddings and continuous numerical features. The formula is: <strong>sqrt(Σ(a[i] - b[i])²)</strong></p>
<p>This one's interesting because we can use SIMD for both the subtraction and the squaring (<a href="https://github.com/deven96/ahnlich/blob/main/ahnlich/db/src/algorithm/similarity.rs#L198-L231" target="_blank" rel="noopener noreferrer" class="">source</a>):</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">impl</span><span class="token plain"> </span><span class="token class-name">WithSimd</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token class-name">EuclideanDistance</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol" style="color:rgb(248, 248, 242)">'_</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">type</span><span class="token plain"> </span><span class="token type-definition class-name">Output</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token attribute attr-name" style="color:rgb(241, 250, 140)">#[inline(always)]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">with_simd</span><span class="token operator">&lt;</span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">Simd</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">Self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token class-name">Output</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">first_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> first_tail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">as_simd_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">second_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> second_tail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">S</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">as_simd_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">self</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token plain">second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> sum_of_squares </span><span class="token operator">=</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">splat_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">cord_first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">cord_second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> first_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">second_head</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> diff </span><span class="token operator">=</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sub_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">cord_first</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> cord_second</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// 4 subtractions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sum_of_squares </span><span class="token operator">=</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">mul_add_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">diff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> diff</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> sum_of_squares</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain">  </span><span class="token comment" style="color:rgb(98, 114, 164)">// 4 squares + 4 adds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> total </span><span class="token operator">=</span><span class="token plain"> simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">reduce_sum_f32s</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">sum_of_squares</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token comment" style="color:rgb(98, 114, 164)">// Scalar remainder</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        total </span><span class="token operator">+=</span><span class="token plain"> first_tail</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">second_tail</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params operator">&amp;</span><span class="token closure-params">x</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token closure-params"> </span><span class="token closure-params operator">&amp;</span><span class="token closure-params">y</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> diff </span><span class="token operator">=</span><span class="token plain"> x </span><span class="token operator">-</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">                diff </span><span class="token operator">*</span><span class="token plain"> diff</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token operator">&gt;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        total</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sqrt</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>Notice how we're doing 8 SIMD operations per iteration (4 subtractions + 4 multiply-adds), making this particularly efficient.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-benchmark-results">The Benchmark Results<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#the-benchmark-results" class="hash-link" aria-label="Direct link to The Benchmark Results" title="Direct link to The Benchmark Results" translate="no">​</a></h2>
<p>Let's see how our SIMD implementation performs. Testing with 100,000 vectors of 1024 dimensions each on Apple M1:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">main</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> dimension </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">1024</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> size </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">100_000</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token operator">&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">dimension</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">i</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">0.1</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> vectors</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token operator">&gt;&gt;</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">size</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">_</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token number">0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">..</span><span class="token plain">dimension</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params">i</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> i </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">as</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token operator">*</span><span class="token plain"> </span><span class="token number">0.01</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">collect</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Benchmark scalar</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> start </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Instant</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> v </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">vectors </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dot_product_scalar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> scalar_duration </span><span class="token operator">=</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">elapsed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token comment" style="color:rgb(98, 114, 164)">// Benchmark SIMD</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> start </span><span class="token operator">=</span><span class="token plain"> </span><span class="token class-name">Instant</span><span class="token punctuation" style="color:rgb(248, 248, 242)">::</span><span class="token function" style="color:rgb(80, 250, 123)">now</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> v </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">vectors </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> _ </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(80, 250, 123)">dot_product_simd</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token operator">&amp;</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> v</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> simd_duration </span><span class="token operator">=</span><span class="token plain"> start</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">elapsed</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token macro property">println!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Scalar: {:?}"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> scalar_duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token macro property">println!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"SIMD:   {:?}"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> simd_duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token macro property">println!</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token string" style="color:rgb(255, 121, 198)">"Speedup: {:.2}x"</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> scalar_duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">as_secs_f64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token operator">/</span><span class="token plain"> simd_duration</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">as_secs_f64</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p><strong>Results (Apple M1 with ARM NEON)</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Scalar duration: 111.22ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SIMD duration:   23.49ms</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">Speedup: 4.73x</span><br></span></code></pre></div></div>
<p>4.7x faster with SIMD. For a vector database handling millions of similarity calculations per second, this translates to significant real-world performance improvements.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="peeking-under-the-hood-the-assembly">Peeking Under the Hood: The Assembly<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#peeking-under-the-hood-the-assembly" class="hash-link" aria-label="Direct link to Peeking Under the Hood: The Assembly" title="Direct link to Peeking Under the Hood: The Assembly" translate="no">​</a></h2>
<p>Let's verify what's actually happening at the assembly level. Using <code>cargo-show-asm</code>, we can inspect the generated machine code:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">cargo install cargo-show-asm</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">cargo asm --rust simd_bench::dot_product_simd</span><br></span></code></pre></div></div>
<p>Key SIMD instruction from the output:</p>
<div class="language-asm codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-asm codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">LBB0_4:</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ldr q1, [x10], #16       ; Load 4 x f32 from first array into vector register</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    ldr q2, [x11], #16       ; Load 4 x f32 from second array into vector register</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    fmla.4s v0, v2, v1       ; Fused multiply-add: v0 += v2 * v1 (4 operations!)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    subs x9, x9, #1          ; Decrement counter</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    b.ne LBB0_4              ; Loop if not done</span><br></span></code></pre></div></div>
<p>The magic line is <code>fmla.4s v0, v2, v1</code>. This single ARM NEON instruction performs <strong>4 multiply-adds simultaneously</strong>. Instead of:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">result += a[0] * b[0]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result += a[1] * b[1]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result += a[2] * b[2]</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">result += a[3] * b[3]</span><br></span></code></pre></div></div>
<p>We get all four operations in <strong>one instruction cycle</strong>. That's the power of SIMD.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-auto-vectorization-question">The Auto-Vectorization Question<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#the-auto-vectorization-question" class="hash-link" aria-label="Direct link to The Auto-Vectorization Question" title="Direct link to The Auto-Vectorization Question" translate="no">​</a></h2>
<p>Modern compilers like LLVM are surprisingly good at auto-vectorization. You might wonder, "Does the compiler already vectorize my scalar code?"</p>
<p>Sometimes, but not always.</p>
<p>Let's examine what LLVM does with our scalar implementation. The scalar version uses iterator combinators:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">dot_product_scalar</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    a</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">zip</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">b</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">map</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token closure-params operator">&amp;</span><span class="token closure-params">x</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token closure-params"> </span><span class="token closure-params operator">&amp;</span><span class="token closure-params">y</span><span class="token closure-params punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token closure-params closure-punctuation punctuation" style="color:rgb(248, 248, 242)">|</span><span class="token plain"> x </span><span class="token operator">*</span><span class="token plain"> y</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>When compiled with <code>-C opt-level=3</code> (release mode), LLVM's auto-vectorizer kicks in and <strong>does</strong> generate SIMD instructions for this simple pattern. This is why our benchmark shows good scalar performance, it's actually using SIMD under the hood!</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="proving-auto-vectorization">Proving Auto-Vectorization<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#proving-auto-vectorization" class="hash-link" aria-label="Direct link to Proving Auto-Vectorization" title="Direct link to Proving Auto-Vectorization" translate="no">​</a></h3>
<p>We can verify this by examining the assembly or by disabling SIMD features entirely. On ARM, we can disable NEON:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">RUSTFLAGS="-C target-feature=-neon" cargo run --release</span><br></span></code></pre></div></div>
<p><strong>Results without NEON</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token plain">Scalar duration: 762.05ms  (7x slower)</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">SIMD duration:   131.84ms  (explicit SIMD fallback path)</span><br></span></code></pre></div></div>
<p>The scalar version tanks without auto-vectorization, taking <strong>762ms</strong> instead of <strong>111ms</strong>.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-explicit-simd-still-matters">Why Explicit SIMD Still Matters<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#why-explicit-simd-still-matters" class="hash-link" aria-label="Direct link to Why Explicit SIMD Still Matters" title="Direct link to Why Explicit SIMD Still Matters" translate="no">​</a></h3>
<p>If compilers auto-vectorize, why write explicit SIMD code?</p>
<ol>
<li class="">
<p><strong>Compiler Limitations</strong>: Auto-vectorization works well for simple loops but fails on complex patterns. Vector databases have intricate algorithms (graph traversal, tree searches) where manual SIMD wins.</p>
</li>
<li class="">
<p><strong>Portability Guarantees</strong>: Auto-vectorization quality varies across:</p>
<ul>
<li class="">Different compilers (GCC vs Clang vs MSVC)</li>
<li class="">Compiler versions (what works in LLVM 15 may not in LLVM 12)</li>
<li class="">Target architectures (x86 vs ARM vs RISC-V)</li>
</ul>
<p>Explicit SIMD using <code>pulp</code> ensures consistent performance everywhere.</p>
</li>
<li class="">
<p><strong>Control Over Optimization</strong>: Sometimes you need fine-grained control:</p>
<ul>
<li class="">Custom reduction operations</li>
<li class="">Specific instruction selection (FMA over separate mul+add)</li>
<li class="">Memory alignment requirements</li>
</ul>
</li>
<li class="">
<p><strong>Performance Predictability</strong>: Auto-vectorization is "best effort." A small code change can break vectorization without warning. Explicit SIMD gives predictable performance.</p>
</li>
<li class="">
<p><strong>Documentation</strong>: Explicit SIMD clearly communicates intent. Future maintainers know this code <em>must</em> be fast.</p>
</li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="when-auto-vectorization-fails">When Auto-Vectorization Fails<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#when-auto-vectorization-fails" class="hash-link" aria-label="Direct link to When Auto-Vectorization Fails" title="Direct link to When Auto-Vectorization Fails" translate="no">​</a></h3>
<p>Here's a real example where auto-vectorization struggles:</p>
<div class="language-rust codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#F8F8F2;--prism-background-color:#282A36"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-rust codeBlock_bY9V thin-scrollbar" style="color:#F8F8F2;background-color:#282A36"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#F8F8F2"><span class="token comment" style="color:rgb(98, 114, 164)">// Compiler probably vectorizes this ✅</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">simple_sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">iter</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token punctuation" style="color:rgb(248, 248, 242)">.</span><span class="token function" style="color:rgb(80, 250, 123)">sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token comment" style="color:rgb(98, 114, 164)">// Compiler struggles to vectorize this ❌</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">fn</span><span class="token plain"> </span><span class="token function-definition function" style="color:rgb(80, 250, 123)">conditional_sum</span><span class="token punctuation" style="color:rgb(248, 248, 242)">(</span><span class="token plain">arr</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token punctuation" style="color:rgb(248, 248, 242)">[</span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">]</span><span class="token punctuation" style="color:rgb(248, 248, 242)">,</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:rgb(248, 248, 242)">:</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token punctuation" style="color:rgb(248, 248, 242)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">-&gt;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">f32</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">let</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">mut</span><span class="token plain"> sum </span><span class="token operator">=</span><span class="token plain"> </span><span class="token number">0.0</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">for</span><span class="token plain"> </span><span class="token operator">&amp;</span><span class="token plain">val </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">in</span><span class="token plain"> arr </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">if</span><span class="token plain"> val </span><span class="token operator">&gt;</span><span class="token plain"> threshold </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sum </span><span class="token operator">+=</span><span class="token plain"> val </span><span class="token operator">*</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(189, 147, 249);font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(248, 248, 242)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">            sum </span><span class="token operator">+=</span><span class="token plain"> val</span><span class="token punctuation" style="color:rgb(248, 248, 242)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain">    sum</span><br></span><span class="token-line" style="color:#F8F8F2"><span class="token plain"></span><span class="token punctuation" style="color:rgb(248, 248, 242)">}</span><br></span></code></pre></div></div>
<p>Branches inside hot loops confuse auto-vectorizers. SIMD techniques like masking or blend instructions can handle this, but you need explicit SIMD to access them.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="visualizing-auto-vectorization">Visualizing Auto-Vectorization<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#visualizing-auto-vectorization" class="hash-link" aria-label="Direct link to Visualizing Auto-Vectorization" title="Direct link to Visualizing Auto-Vectorization" translate="no">​</a></h3>
<p>Here's what happens at compile time:</p>
<p><img decoding="async" loading="lazy" alt="Auto-vectorization Flow" src="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iODAwIiBoZWlnaHQ9IjYwMCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICA8ZGVmcz4KICAgIDxtYXJrZXIgaWQ9ImFycm93IiBtYXJrZXJXaWR0aD0iMTAiIG1hcmtlckhlaWdodD0iMTAiIHJlZlg9IjkiIHJlZlk9IjMiIG9yaWVudD0iYXV0byI+CiAgICAgIDxwb2x5Z29uIHBvaW50cz0iMCAwLCAxMCAzLCAwIDYiIGZpbGw9IiM5NGEzYjgiIC8+CiAgICA8L21hcmtlcj4KICA8L2RlZnM+CiAgCiAgPCEtLSBCYWNrZ3JvdW5kIC0tPgogIDxyZWN0IHdpZHRoPSI4MDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMGYxNzJhIi8+CiAgCiAgPCEtLSBUaXRsZSAtLT4KICA8dGV4dCB4PSI0MDAiIHk9IjQwIiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjIiIGZpbGw9IiNmMWY1ZjkiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtd2VpZ2h0PSJib2xkIj5BdXRvLVZlY3Rvcml6YXRpb24gRmxvdzwvdGV4dD4KICAKICA8IS0tIFNvdXJjZSBDb2RlIEJveCAtLT4KICA8cmVjdCB4PSIyMDAiIHk9IjcwIiB3aWR0aD0iNDAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iIzFlMjkzYiIgc3Ryb2tlPSIjNDc1NTY5IiBzdHJva2Utd2lkdGg9IjIiIHJ4PSI4Ii8+CiAgPHRleHQgeD0iNDAwIiB5PSI5NSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNCIgZmlsbD0iI2ZiYmYyNCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPllvdXIgU291cmNlIENvZGU8L3RleHQ+CiAgPHRleHQgeD0iNDAwIiB5PSIxMjAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNjYmQ1ZTEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPmZvciB4LCB5IGluIGEuemlwKGIpIHs8L3RleHQ+CiAgPHRleHQgeD0iNDAwIiB5PSIxNDAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNjYmQ1ZTEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPiAgICBzdW0gKz0geCAqIHk8L3RleHQ+CiAgPHRleHQgeD0iNDAwIiB5PSIxNjAiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiNjYmQ1ZTEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPn08L3RleHQ+CiAgCiAgPCEtLSBBcnJvdyBkb3duIC0tPgogIDxsaW5lIHgxPSI0MDAiIHkxPSIxODAiIHgyPSI0MDAiIHkyPSIyMjAiIHN0cm9rZT0iIzk0YTNiOCIgc3Ryb2tlLXdpZHRoPSIyIiBtYXJrZXItZW5kPSJ1cmwoI2Fycm93KSIvPgogIAogIDwhLS0gTExWTSBPcHRpbWl6ZXIgQm94IC0tPgogIDxyZWN0IHg9IjIwMCIgeT0iMjMwIiB3aWR0aD0iNDAwIiBoZWlnaHQ9IjYwIiBmaWxsPSIjMzEyZTgxIiBzdHJva2U9IiM2MzY2ZjEiIHN0cm9rZS13aWR0aD0iMiIgcng9IjgiLz4KICA8dGV4dCB4PSI0MDAiIHk9IjI1NSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE2IiBmaWxsPSIjYzdkMmZlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+TExWTSBPcHRpbWl6ZXI8L3RleHQ+CiAgPHRleHQgeD0iNDAwIiB5PSIyNzUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiNhNWI0ZmMiIHRleHQtYW5jaG9yPSJtaWRkbGUiPih3aXRoIC1DIG9wdC1sZXZlbD0zKTwvdGV4dD4KICAKICA8IS0tIEFycm93IGRvd24gLS0+CiAgPGxpbmUgeDE9IjQwMCIgeTE9IjMwMCIgeDI9IjQwMCIgeTI9IjMzMCIgc3Ryb2tlPSIjOTRhM2I4IiBzdHJva2Utd2lkdGg9IjIiIG1hcmtlci1lbmQ9InVybCgjYXJyb3cpIi8+CiAgCiAgPCEtLSBBbmFseXNpcyBCb3ggLS0+CiAgPHJlY3QgeD0iMTUwIiB5PSIzNDAiIHdpZHRoPSI1MDAiIGhlaWdodD0iMTIwIiBmaWxsPSIjMWUyOTNiIiBzdHJva2U9IiM0NzU1NjkiIHN0cm9rZS13aWR0aD0iMiIgcng9IjgiLz4KICA8dGV4dCB4PSI0MDAiIHk9IjM2NSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjE1IiBmaWxsPSIjZTJlOGYwIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LXdlaWdodD0iYm9sZCI+QXV0by12ZWN0b3JpemF0aW9uIEFuYWx5c2lzPC90ZXh0PgogIAogIDx0ZXh0IHg9IjE4MCIgeT0iMzk1IiBmb250LWZhbWlseT0iQXJpYWwsIHNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMTMiIGZpbGw9IiM5NGEzYjgiPuKckyBMb29wIGJvdW5kcyBjaGVjazwvdGV4dD4KICA8dGV4dCB4PSIxODAiIHk9IjQyMCIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmaWxsPSIjOTRhM2I4Ij7inJMgRGVwZW5kZW5jeSBhbmFseXNpczwvdGV4dD4KICA8dGV4dCB4PSIxODAiIHk9IjQ0NSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEzIiBmaWxsPSIjOTRhM2I4Ij7inJMgQ29zdCBtb2RlbCBldmFsdWF0aW9uPC90ZXh0PgogIAogIDxjaXJjbGUgY3g9IjQ2MCIgY3k9IjM4NyIgcj0iNDAiIGZpbGw9IiMwNjVmNDYiIHN0cm9rZT0iIzEwYjk4MSIgc3Ryb2tlLXdpZHRoPSIyIi8+CiAgPHRleHQgeD0iNDYwIiB5PSIzOTgiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIzMiIgZmlsbD0iIzEwYjk4MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPuKckzwvdGV4dD4KICA8dGV4dCB4PSI0NjAiIHk9IjQzNSIgZm9udC1mYW1pbHk9IkFyaWFsLCBzYW5zLXNlcmlmIiBmb250LXNpemU9IjEyIiBmaWxsPSIjNmVlN2I3IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5QYXR0ZXJuIGZvdW5kITwvdGV4dD4KICAKICA8IS0tIEFycm93IGRvd24gLS0+CiAgPGxpbmUgeDE9IjQwMCIgeTE9IjQ3MCIgeDI9IjQwMCIgeTI9IjUwMCIgc3Ryb2tlPSIjOTRhM2I4IiBzdHJva2Utd2lkdGg9IjIiIG1hcmtlci1lbmQ9InVybCgjYXJyb3cpIi8+CiAgCiAgPCEtLSBPdXRwdXQgQm94IC0tPgogIDxyZWN0IHg9IjIwMCIgeT0iNTEwIiB3aWR0aD0iNDAwIiBoZWlnaHQ9IjcwIiBmaWxsPSIjMWUyOTNiIiBzdHJva2U9IiMxMGI5ODEiIHN0cm9rZS13aWR0aD0iMyIgcng9IjgiLz4KICA8dGV4dCB4PSI0MDAiIHk9IjUzNSIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzEwYjk4MSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC13ZWlnaHQ9ImJvbGQiPkVtaXRzIFNJTUQgQ29kZTo8L3RleHQ+CiAgPHRleHQgeD0iNDAwIiB5PSI1NTUiIGZvbnQtZmFtaWx5PSJtb25vc3BhY2UiIGZvbnQtc2l6ZT0iMTIiIGZpbGw9IiNjYmQ1ZTEiIHRleHQtYW5jaG9yPSJtaWRkbGUiPmxkciBxMSwgW3gxMF0sICMxNjwvdGV4dD4KICA8dGV4dCB4PSI0MDAiIHk9IjU3MCIgZm9udC1mYW1pbHk9Im1vbm9zcGFjZSIgZm9udC1zaXplPSIxMiIgZmlsbD0iI2NiZDVlMSIgdGV4dC1hbmNob3I9Im1pZGRsZSI+Zm1sYS40cyB2MCwgdjIsIHYxPC90ZXh0Pgo8L3N2Zz4K" width="800" height="600" class="img_ev3q"></p>
<p>With explicit SIMD using <code>pulp</code>, we bypass these heuristics and tell the compiler exactly what to do.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="the-real-world-impact">The Real-World Impact<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#the-real-world-impact" class="hash-link" aria-label="Direct link to The Real-World Impact" title="Direct link to The Real-World Impact" translate="no">​</a></h2>
<p>While our simple dot product didn't show dramatic speedups on M1 due to auto-vectorization, the benefits become clear in:</p>
<ul>
<li class=""><strong>Cross-platform consistency</strong>: The SIMD code performs predictably across ARM, x86, and other architectures</li>
<li class=""><strong>Complex algorithms</strong>: KD-tree and HNSW implementations benefit from hand-tuned SIMD</li>
<li class=""><strong>Future-proofing</strong>: As we add more sophisticated distance metrics, explicit SIMD control helps maintain performance</li>
</ul>
<p>Here's our full suite of similarity algorithms using SIMD:</p>
<table><thead><tr><th>Algorithm</th><th>Use Case</th><th>SIMD Benefit</th></tr></thead><tbody><tr><td>Cosine Similarity</td><td>Text embeddings, semantic search</td><td>Magnitude + dot product SIMD</td></tr><tr><td>Euclidean Distance</td><td>Image vectors, continuous features</td><td>Fused multiply-add for differences</td></tr><tr><td>Dot Product</td><td>Recommendation systems</td><td>Direct SIMD multiplication</td></tr></tbody></table>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="key-takeaways">Key Takeaways<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#key-takeaways" class="hash-link" aria-label="Direct link to Key Takeaways" title="Direct link to Key Takeaways" translate="no">​</a></h2>
<ol>
<li class=""><strong>SIMD provides real speedups</strong>: We achieved 4.7x faster dot product calculations on ARM NEON</li>
<li class=""><strong>Modern compilers auto-vectorize simple patterns</strong>: LLVM turned our scalar code into SIMD instructions automatically</li>
<li class=""><strong>Auto-vectorization has limits</strong>: Complex algorithms, branches, and intricate patterns need explicit SIMD</li>
<li class=""><strong>Explicit SIMD guarantees performance</strong>: No surprises across compilers, versions, or architectures</li>
<li class=""><strong>The <code>pulp</code> crate rocks</strong>: Portable SIMD in Rust without drowning in architecture-specific intrinsics</li>
<li class=""><strong>Always verify with assembly</strong>: Use <code>cargo-show-asm</code> to see what's really happening</li>
<li class=""><strong>Benchmark on real hardware</strong>: Measure performance on your actual target architecture</li>
</ol>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="epilogue-what-about-linuxx86">Epilogue: What About Linux/x86?<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#epilogue-what-about-linuxx86" class="hash-link" aria-label="Direct link to Epilogue: What About Linux/x86?" title="Direct link to Epilogue: What About Linux/x86?" translate="no">​</a></h2>
<p>The benchmarks shown here are on Apple M1 (ARM NEON). On Intel/AMD with AVX2 or AVX-512, the SIMD width is larger (8 to 16 x f32 vs 4 x f32), which means:</p>
<ul>
<li class="">More parallelism per instruction</li>
<li class="">Different auto-vectorization behavior</li>
<li class="">Potentially larger SIMD vs scalar gaps</li>
</ul>
<p>If you're running Ahnlich on x86, I'd love to see your benchmark results! Open an issue or PR on <a href="https://github.com/deven96/ahnlich" target="_blank" rel="noopener noreferrer" class="">GitHub</a> with your numbers.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="references">References<a href="https://ahnlich.dev/blog/simd-optimization-vector-database#references" class="hash-link" aria-label="Direct link to References" title="Direct link to References" translate="no">​</a></h2>
<ul>
<li class=""><a href="https://github.com/deven96/ahnlich" target="_blank" rel="noopener noreferrer" class="">Ahnlich GitHub Repository</a></li>
<li class=""><a href="https://crates.io/crates/pulp" target="_blank" rel="noopener noreferrer" class="">Pulp: Portable SIMD for Rust</a></li>
<li class=""><a href="https://llvm.org/docs/Vectorizers.html" target="_blank" rel="noopener noreferrer" class="">LLVM Auto-Vectorization Documentation</a></li>
<li class=""><a href="https://llvm.org/devmtg/2013-04/achalmers-slides.pdf" target="_blank" rel="noopener noreferrer" class="">Understanding LLVM's Loop Vectorizer</a></li>
<li class=""><a href="https://developer.arm.com/architectures/instruction-sets/simd-isas/neon" target="_blank" rel="noopener noreferrer" class="">ARM NEON Intrinsics Guide</a></li>
<li class=""><a href="https://www.intel.com/content/www/us/en/docs/intrinsics-guide/index.html" target="_blank" rel="noopener noreferrer" class="">Intel AVX Intrinsics Reference</a></li>
<li class=""><a href="https://github.com/pacak/cargo-show-asm" target="_blank" rel="noopener noreferrer" class="">Cargo Show ASM Tool</a></li>
<li class=""><a href="https://nnethercote.github.io/perf-book/simd.html" target="_blank" rel="noopener noreferrer" class="">Rust Performance Book - SIMD</a></li>
</ul>
<hr>
<p><em>Want to try Ahnlich? Check out our <a href="https://ahnlich.rs/" target="_blank" rel="noopener noreferrer" class="">documentation</a> and join our community. Contributions welcome!</em></p>]]></content:encoded>
            <category>Ahnlich</category>
            <category>Performance</category>
            <category>simd</category>
            <category>rust</category>
        </item>
    </channel>
</rss>