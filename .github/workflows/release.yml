name: Ahnlich AI and DB Release

on:
    release:
      types: [published]


permissions:
  contents: write

jobs:

    build:
        name: Build Binaries
        runs-on: ubuntu-latest
        steps:
            - name: "Checkout"
              uses: actions/checkout@v4

            - name: "Get Binary Version"
              id: get_binary_version
              run: |
                  cd ${{github.workspace}}
                  echo ${{ github.event.release.tag_name }}
                  value=$(echo "${{ github.event.release.tag_name }}" | cut -d'/' -f2)
                  echo "$value"
                  echo "BIN_NAME=${value}" >> $GITHUB_OUTPUT

            - name: Get Cargo toolchain
              uses: actions-rs/toolchain@v1
              with:
                toolchain: 1.78.0

            - name: Build Linux Release
              working-directory: ./ahnlich
              run: |
                cargo build --release --bin ahnlich-${{ steps.get_binary_version.outputs.BIN_NAME }}
                tar -cvzf linux-ahnlich-db.tar.gz -C target/release ahnlich-${{ steps.get_binary_version.outputs.BIN_NAME }}
                gh release upload ${{github.event.release.tag_name}} linux-ahnlich-db.tar.gz
              env:
                GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
              shell: bash




